<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE packagegui SYSTEM "../schema/packages.dtd">
<?xml-stylesheet type="text/xsl" href="./xsl/package.xsl"?>
<packagegui>
	<copyright>
	<![CDATA[
/*
 * dnscrypt-proxy-cache.xml
 *
 * for pfSense
 * Copyright (c) 2026 nopoz (https://github.com/nopoz)
 * SPDX-License-Identifier: ISC
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */
	]]>
	</copyright>
	<name>dnscryptproxy</name>
	<title>Services: DNSCrypt Proxy</title>
	<shortcut_section>dnscrypt-proxy</shortcut_section>
	<configpath>installedpackages->dnscryptproxy->config</configpath>
	<aftersaveredirect>/pkg_edit.php?xml=dnscrypt-proxy-cache.xml</aftersaveredirect>
	<include_file>/usr/local/pkg/dnscrypt-proxy.inc</include_file>
	<tabs>
		<tab>
			<text>General Settings</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy.xml</url>
		</tab>
		<tab>
			<text>Server Selection</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy-servers.xml</url>
		</tab>
		<tab>
			<text>Cache &amp; Filtering</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy-cache.xml</url>
			<active/>
		</tab>
		<tab>
			<text>Logging</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy-logging.xml</url>
		</tab>
		<tab>
			<text>Lists</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy-lists.xml</url>
		</tab>
		<tab>
			<text>Advanced</text>
			<url>/pkg_edit.php?xml=dnscrypt-proxy-advanced.xml</url>
		</tab>
		<tab>
			<text>Query Log</text>
			<url>/dnscrypt-proxy-querylog.php</url>
		</tab>
	</tabs>
	<fields>
		<field>
			<name>DNS Cache</name>
			<type>listtopic</type>
		</field>
		<field>
			<fielddescr>Enable Cache</fielddescr>
			<fieldname>cache</fieldname>
			<description>Enable local DNS response caching</description>
			<type>checkbox</type>
			<default_value>on</default_value>
		</field>
		<field>
			<fielddescr>Cache Size</fielddescr>
			<fieldname>cache_size</fieldname>
			<description>Maximum number of DNS entries to cache. Default: 4096</description>
			<type>input</type>
			<size>10</size>
			<default_value>4096</default_value>
		</field>
		<field>
			<fielddescr>Cache Min TTL (seconds)</fielddescr>
			<fieldname>cache_min_ttl</fieldname>
			<description>Minimum TTL for cached entries. Default: 2400 (40 minutes)</description>
			<type>input</type>
			<size>10</size>
			<default_value>2400</default_value>
		</field>
		<field>
			<fielddescr>Cache Max TTL (seconds)</fielddescr>
			<fieldname>cache_max_ttl</fieldname>
			<description>Maximum TTL for cached entries. Default: 86400 (24 hours)</description>
			<type>input</type>
			<size>10</size>
			<default_value>86400</default_value>
		</field>
		<field>
			<name>Query Filtering</name>
			<type>listtopic</type>
		</field>
		<field>
			<fielddescr>Block IPv6</fielddescr>
			<fieldname>block_ipv6</fieldname>
			<description>Immediately respond with empty answer to AAAA queries (IPv6)</description>
			<type>checkbox</type>
		</field>
		<field>
			<fielddescr>Block Unqualified</fielddescr>
			<fieldname>block_unqualified</fieldname>
			<description>Block queries for single-label names (e.g., "server" instead of "server.domain.com")</description>
			<type>checkbox</type>
			<default_value>on</default_value>
		</field>
		<field>
			<fielddescr>Block Undelegated</fielddescr>
			<fieldname>block_undelegated</fieldname>
			<description>Block queries for locally-served zones (RFC 6303 - home, lan, local, etc.)</description>
			<type>checkbox</type>
			<default_value>on</default_value>
		</field>
	</fields>
	<custom_php_resync_config_command>
		dnscrypt_proxy_sync();
	</custom_php_resync_config_command>
	<custom_php_validation_command>
		dnscrypt_proxy_validate($_POST, $input_errors);
	</custom_php_validation_command>
	<custom_add_php_command_late>
		dnscrypt_proxy_save_config_late();
	</custom_add_php_command_late>
</packagegui>
